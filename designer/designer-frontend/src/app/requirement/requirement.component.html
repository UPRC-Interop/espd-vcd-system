<!--

    Copyright 2016-2018 University of Piraeus Research Center

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<div [formGroup]="form">
  <div>
    <label *ngIf="req.responseDataType=='INDICATOR'" [attr.for]="req.uuid">{{req.description}}</label>
    <label *ngIf="req.responseDataType=='WEIGHT_INDICATOR' && this.utilities.isGloballyWeighted" [attr.for]="req.uuid">{{req.description}}</label>
  </div>




  <!--SELF-CONTAINED: Hide the QUESTION fields if the user is a CA making a Request. Render only the REQUIREMENT and CAPTION fields.
  Don't show the REQUIREMENT fields if the user has the role of EO and creates a new ESPD response from scratch-->
  <div [ngSwitch]="req.responseDataType" [hidden]="(this.utilities.isCA && req.type === 'QUESTION') || (this.utilities.isEO &&
  req.type ==='REQUIREMENT' && this.utilities.isCreateResponse) || req.type === 'CAPTION'">
    <div *ngSwitchDefault>
      <div *ngIf="req.type === 'CAPTION'">
        <!-- SKIP captions and deal with question and requirement only -->
      </div>
      <div *ngIf="req.type === 'QUESTION'">
        <mat-form-field>
          <label [attr.for]="req.uuid">{{req.description}}</label>
          <br>
          <input matInput [formControlName]="req.uuid" [id]="req.uuid" >
        </mat-form-field>
      </div>
      <div *ngIf="req.type === 'REQUIREMENT'">
        <mat-form-field>
          <label [attr.for]="req.uuid">{{req.description}}</label>
          <br>
          <input matInput [formControlName]="req.uuid" [id]="req.uuid" >
        </mat-form-field>
      </div>
    </div>
    <mat-form-field *ngSwitchCase="'DATE'">
      <label [attr.for]="req.uuid">{{req.description}}</label>
      <br>
      <input matInput [matDatepicker]="picker" [formControlName]="req.uuid" [id]="req.uuid">
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <div class="period" *ngSwitchCase="'PERIOD'" >
      <div class="periodv2" *ngIf="APIService.version === 'v2'">
        <label [attr.for]="req.uuid+'startDate'">Start Date: </label>
        <br>
        <mat-form-field >
          <input matInput [matDatepicker]="startPicker" [formControlName]="req.uuid+'startDate'" [id]="req.uuid+'startDate'">
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>
        <br>
        <label [attr.for]="req.uuid+'endDate'">End Date: </label>
        <br>
        <mat-form-field >
          <input matInput [matDatepicker]="endPicker" [formControlName]="req.uuid+'endDate'" [id]="req.uuid+'endDate'">
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>
      </div>
      <div class="periodv1" *ngIf="APIService.version === 'v1'">
        <label [attr.for]="req.uuid">{{req.description}}</label>
        <br>
        <mat-form-field >
          <input matInput [formControlName]="req.uuid" [id]="req.uuid" >
        </mat-form-field>
      </div>
    </div>
    <div *ngSwitchCase="'CODE'">
      <div [ngSwitch]="req.responseValuesRelatedArtefact">
        <mat-form-field *ngSwitchCase="'BidType'">
          <label [attr.for]="req.uuid">{{req.description}}</label>
          <br>
          <mat-select [formControlName]="req.uuid" [id]="req.uuid">
            <mat-option>None</mat-option>
            <mat-option *ngFor="let bid of codelist.bidTypes" [value]="bid.code">{{bid.name}}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field *ngSwitchCase="'FinancialRatioType'">
          <label [attr.for]="req.uuid">{{req.description}}</label>
          <br>
          <mat-select [formControlName]="req.uuid" [id]="req.uuid">
            <mat-option>None</mat-option>
            <mat-option *ngFor="let type of codelist.financialRatioTypes" [value]="type.code">{{type.name}}</mat-option>
          </mat-select>
        </mat-form-field>
        <div *ngSwitchCase="'CPVCodes'">
          <!-- TODO cpvs like the classificationCodes -->
          <mat-form-field class="cpv-chip-list">
            <mat-chip-list #chipList [disabled]="disabled">
              <mat-chip color='primary' selected=true *ngFor="let cpv of cpvCodes" [selectable]="selectable"
                        [removable]="removable" (removed)="remove(cpv)">
                {{cpv}}
                <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
              </mat-chip>
              <input placeholder="CPV Codes: "
                     [matChipInputFor]="chipList"
                     [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                     [matChipInputAddOnBlur]="addOnBlur"
                     (matChipInputTokenEnd)="add($event)"
                     (keyup.enter)= 'createChips()'>
            </mat-chip-list>
          </mat-form-field>
        </div>
      </div>
    </div>



    <mat-form-field *ngSwitchCase="'CODE_COUNTRY'">
      <label [attr.for]="req.uuid">{{req.description}}</label>
      <br>
      <mat-select  [formControlName]="req.uuid" [id]="req.uuid">
        <mat-option>None</mat-option>
        <mat-option *ngFor="let country of codelist.countries" [value]="country.code">{{country.name}}</mat-option>
      </mat-select>
    </mat-form-field>


    <div class="amount" *ngSwitchCase="'AMOUNT'">
      <label [attr.for]="req.uuid">{{req.description}}</label>
      <br>
      <mat-form-field>
        <input matInput [formControlName]="req.uuid" [id]="req.uuid">
      </mat-form-field>
      <mat-form-field>
        <mat-select [formControlName]="req.uuid+'currency'" [id]="req.uuid+'currency'">
          <mat-option>None</mat-option>
          <mat-option *ngFor="let curr of codelist.currency" [value]="curr.code">{{curr.code}} ( {{curr.name}} )</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="evidence_identifier" *ngSwitchCase="'EVIDENCE_IDENTIFIER'">
      <label [attr.for]="req.uuid+'evidenceUrl'">URL: </label>
      <br>
      <mat-form-field>
        <input matInput [formControlName]="req.uuid+'evidenceUrl'" [id]="req.uuid+'evidenceUrl'" >
      </mat-form-field>
      <label [attr.for]="req.uuid+'evidenceCode'">Reference/Code: </label>
      <br>
      <mat-form-field>
        <input matInput [formControlName]="req.uuid+'evidenceCode'" [id]="req.uuid+'evidenceCode'" >
      </mat-form-field>
      <label [attr.for]="req.uuid+'evidenceIssuer'">Issuer: </label>
      <br>
      <mat-form-field>
        <input matInput [formControlName]="req.uuid+'evidenceIssuer'" [id]="req.uuid+'evidenceIssuer'" >
      </mat-form-field>
    </div>


    <mat-radio-group [id]="req.uuid" *ngSwitchCase="'INDICATOR'" [formControlName]="req.uuid">
      <mat-radio-button color="primary"
                        [value]=true>YES
      </mat-radio-button>
      <mat-radio-button color="primary"
                        [value]=false>NO
      </mat-radio-button>
    </mat-radio-group>

    <!-- SELF-CONTAINED: WEIGHT_INDICATOR -->
    <div class="weight_indicator" *ngSwitchCase="'WEIGHT_INDICATOR'">
      <div *ngIf="this.utilities.isGloballyWeighted">
        <mat-radio-group [id]="req.uuid" [formControlName]="req.uuid">
          <mat-radio-button color="primary"
                            [value]=true>YES
          </mat-radio-button>
          <mat-radio-button color="primary"
                            [value]=false>NO
          </mat-radio-button>
        </mat-radio-group>
      </div>
      <br>
      <div class="weight" *ngIf="isWeighted">
        <!-- REMOVED: EvaluationMethodType dropdown, the user answers YES/NO to the question and the dropdown is redundant -->
        <!--<label [attr.for]="req.uuid+'evaluationMethodType'">Criterion evaluation method: </label>-->
        <!--<br>-->
        <!--<mat-form-field>-->
          <!--<mat-select [formControlName]="req.uuid+'evaluationMethodType'" [id]="req.uuid+'evaluationMethodType'">-->
            <!--<mat-option>None</mat-option>-->
            <!--<mat-option *ngFor="let type of evaluationMethodTypes" [value]="type.code">{{type.code}} ( {{type.name}} )</mat-option>-->
          <!--</mat-select>-->
        <!--</mat-form-field>-->
        <label [attr.for]="req.uuid+'weight'">Weight allocated to this criterion: </label>
        <br>
        <mat-form-field>
          <input matInput [formControlName]="req.uuid+'weight'" [id]="req.uuid+'weight'" >
        </mat-form-field>
        <label [attr.for]="req.uuid+'evaluationMethodDescription'">Provide complementary information about the evaluation of the criterion: </label>
        <br>
        <mat-form-field>
          <textarea matInput
                    [formControlName]="req.uuid+'evaluationMethodDescription'" [id]="req.uuid+'evaluationMethodDescription'"
                    id="shortDesc" cols="30" rows="10">
          </textarea>
          <!--<input matInput [formControlName]="req.uuid+'evaluationMethodDescription'" [id]="req.uuid+'evaluationMethodDescription'" >-->
        </mat-form-field>
      </div>
    </div>

    <!-- SELF-CONTAINED: EO_IDENTIFIER -->
    <div class="eo_identifier" *ngSwitchCase="'ECONOMIC_OPERATOR_IDENTIFIER'">
      <label [attr.for]="req.uuid">{{req.description}}</label>
      <br>
      <mat-form-field>
        <input matInput [formControlName]="req.uuid" [id]="req.uuid" >
      </mat-form-field>
      <label [attr.for]="req.uuid+'eoidtype'">Type of ID: </label>
      <br>
      <mat-form-field>
        <mat-select [formControlName]="req.uuid+'eoidtype'" [id]="req.uuid+'eoidtype'">
          <mat-option>None</mat-option>
          <mat-option *ngFor="let type of codelist.eoIDType" [value]="type.code">{{type.code}} ( {{type.name}} )</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <!-- SELF-CONTAINED: LOTS_IDENTIFIER -->
    <div class="lots_identifier" *ngSwitchCase="'LOT_IDENTIFIER'">
      <mat-selection-list #lots>
        <mat-list-option *ngFor="let lot of this.utilities.projectLots" [value]="lot"
                         (click)="pushSelectedLot()">
          {{lot}}
        </mat-list-option>
      </mat-selection-list>
    </div>
  </div>
</div>



